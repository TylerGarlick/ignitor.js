"use strict";
Object.defineProperties(exports, {
  Model: {get: function() {
      return Model;
    }},
  __esModule: {value: true}
});
var $__database__;
var Promise = require('bluebird'),
    _ = require('lodash'),
    Validator = require('jsonschema').validate;
var database = ($__database__ = require("./database"), $__database__ && $__database__.__esModule && $__database__ || {default: $__database__}).database;
var Model = function Model(collection, properties) {
  this._key = null;
  this._rev = null;
  this._id = null;
  this.collection = collection;
  this.properties = properties;
  this.methods = {};
  this.db = Promise.promisifyAll(database.db);
  this.hooks = {
    validating: {
      pre: [],
      post: []
    },
    saving: {
      pre: [],
      post: []
    },
    deletion: {
      pre: [],
      post: []
    }
  };
};
var $Model = Model;
($traceurRuntime.createClass)(Model, {
  get isNew() {
    return !this._id && !this._key;
  },
  get errors() {
    var validationErrors = [];
    if (this.properties)
      return Validator(this, {
        type: 'object',
        properties: this.properties
      }).errors || validationErrors;
    return validationErrors;
  },
  get isValid() {
    return this.errors.length > 0;
  }
}, {
  all: function(options) {
    return this.db.simple.listAsync(this.collection, options);
  },
  findByKey: function(id) {
    return this.db.simple.firstByExampleAsync(this.collection, {_key: id});
  },
  find: function(predicate) {
    var options = arguments[1] !== (void 0) ? arguments[1] : {};
    return this.db.simple.exampleAsync(this.collection, predicate, options);
  },
  query: function(query) {
    var params = arguments[1] !== (void 0) ? arguments[1] : {};
    var options = arguments[2] !== (void 0) ? arguments[2] : {};
    return this.db.query.execAsync(query, params, options);
  },
  exists: function(predicate) {
    var options = arguments[1] !== (void 0) ? arguments[1] : {};
    return this.db.simple.firstByExampleAsync(this.collection, predicate, options);
  },
  save: function(entity) {
    var options = arguments[1] !== (void 0) ? arguments[1] : {
      createCollection: true,
      waitForSync: true
    };
    if (entity._id) {
      if (entity._id)
        delete entity._id;
      if (entity._key)
        delete entity._key;
      if (entity._rev)
        delete entity._rev;
      return this.db.document.putAsync(entity._id, entity).then(this.single(entity._id));
    } else
      return this.db.createAsync(this.collection, entity, options).then(this.single(entity._id));
  },
  delete: function(id) {
    var options = arguments[1] !== (void 0) ? arguments[1] : {};
    return this.db.document.deleteAsync(id, options);
  },
  deleteAll: function(predicate) {
    var options = arguments[1] !== (void 0) ? arguments[1] : {};
    return this.db.simple.removeByExampleAsync(this.collection, predicate, options);
  },
  initialize: function(collection, schema) {
    var options = arguments[2] !== (void 0) ? arguments[2] : {};
    var Stereotype = function Stereotype(instance) {
      $traceurRuntime.superCall(this, $Stereotype.prototype, "constructor", [collection, schema]);
      _.merge(this, instance);
      _.merge(this, this.methods);
    };
    var $Stereotype = Stereotype;
    ($traceurRuntime.createClass)(Stereotype, {}, {}, $Model);
    if (options.statics) {
      _.merge(Stereotype, options.statics);
    }
    return Stereotype;
  }
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZGVsLmpzIiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzUiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMyIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci8wIiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzEiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvNCIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci82IiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzgiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMTAiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMTEiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvNyIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci85Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsS0FBSyxpQkFBaUIsQUFBQyxDQUFDLE9BQU07T0NBOUIsRUFBQyxHQUFFLFlDQXFCO0FBQUUsa0JBQXdCO0lBQUUsQURBOUIsQ0FBQztBRUF2QixXQUFTLENDQVQsRUFBQyxLQUFJLENEQU8sS0FBRyxBQ0FTLENBQUM7Q0pBeUIsQ0FBQzs7QURBbkQsQUFBSSxFQUFBLENBQUEsT0FBTSxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsVUFBUyxDQUFDO0FBQzVCLElBQUEsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLFFBQU8sQ0FBQztBQUNwQixZQUFRLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxZQUFXLENBQUMsU0FBUyxDQUFDO0VBRXRDLFNBQU8sRU1KZixFQUFDLGVBQW9CLENBQUEsT0FBTSxBQUFDLGNBQWtCLENBQ3RDLENBQUEsZ0JBQXFCLHlCQUEyQixDQUFBLGdCQUFxQixHQUFLLEVBQUMsT0FBTSxlQUFtQixDQUQ5RCxB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QVMsQ0FDRCxRQUFPLENBQUc7QVVqRzVCLEFWa0dRLG9CVWxHTSxVQUFVLEFBQUMsOENWa0dYLFVBQVMsQ0FBRyxPQUFLLEVVakdxQixDVmlHbkI7QUFFekIsTUFBQSxNQUFNLEFBQUMsQ0FBQyxJQUFHLENBQUcsU0FBTyxDQUFDLENBQUM7QUFDdkIsTUFBQSxNQUFNLEFBQUMsQ0FBQyxJQUFHLENBQUcsQ0FBQSxJQUFHLFFBQVEsQ0FBQyxDQUFDO0lPckdLLEFQc0dsQyxDT3RHa0M7QUNBeEMsQUFBSSxNQUFBLHlCQUFvQyxDQUFBO0FHQXhDLElBQUMsZUFBYyxZQUFZLENBQUMsQUFBQyw0QkFDMkI7QVgwR3BELE9BQUksT0FBTSxRQUFRLENBQUc7QUFDbkIsTUFBQSxNQUFNLEFBQUMsQ0FBQyxVQUFTLENBQUcsQ0FBQSxPQUFNLFFBQVEsQ0FBQyxDQUFDO0lBQ3RDO0FBQUEsQUFFQSxTQUFPLFdBQVMsQ0FBQztFQUNuQjtDU2hIbUY7QVRtSHJGIiwiZmlsZSI6Im1vZGVsLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIFByb21pc2UgPSByZXF1aXJlKCdibHVlYmlyZCcpXG4gICwgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpXG4gICwgVmFsaWRhdG9yID0gcmVxdWlyZSgnanNvbnNjaGVtYScpLnZhbGlkYXRlO1xuXG5pbXBvcnQge2RhdGFiYXNlfSBmcm9tICcuL2RhdGFiYXNlJztcblxuZXhwb3J0IGNsYXNzIE1vZGVsIHtcblxuICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBwcm9wZXJ0aWVzKSB7XG4gICAgdGhpcy5fa2V5ID0gbnVsbDtcbiAgICB0aGlzLl9yZXYgPSBudWxsO1xuICAgIHRoaXMuX2lkID0gbnVsbDtcblxuICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllcztcbiAgICB0aGlzLm1ldGhvZHMgPSB7fTtcbiAgICB0aGlzLmRiID0gUHJvbWlzZS5wcm9taXNpZnlBbGwoZGF0YWJhc2UuZGIpO1xuXG4gICAgdGhpcy5ob29rcyA9IHtcbiAgICAgIHZhbGlkYXRpbmc6IHtcbiAgICAgICAgcHJlOiBbXSxcbiAgICAgICAgcG9zdDogW11cbiAgICAgIH0sXG5cbiAgICAgIHNhdmluZzoge1xuICAgICAgICBwcmU6IFtdLFxuICAgICAgICBwb3N0OiBbXVxuICAgICAgfSxcblxuICAgICAgZGVsZXRpb246IHtcbiAgICAgICAgcHJlOiBbXSxcbiAgICAgICAgcG9zdDogW11cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBnZXQgaXNOZXcoKSB7XG4gICAgcmV0dXJuICF0aGlzLl9pZCAmJiAhdGhpcy5fa2V5O1xuICB9XG5cbiAgZ2V0IGVycm9ycygpIHtcbiAgICB2YXIgdmFsaWRhdGlvbkVycm9ycyA9IFtdO1xuICAgIGlmICh0aGlzLnByb3BlcnRpZXMpXG4gICAgICByZXR1cm4gVmFsaWRhdG9yKHRoaXMsIHsgdHlwZTogJ29iamVjdCcsIHByb3BlcnRpZXM6IHRoaXMucHJvcGVydGllcyB9KS5lcnJvcnMgfHwgdmFsaWRhdGlvbkVycm9ycztcblxuICAgIHJldHVybiB2YWxpZGF0aW9uRXJyb3JzO1xuICB9XG5cbiAgZ2V0IGlzVmFsaWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuZXJyb3JzLmxlbmd0aCA+IDA7XG4gIH1cblxuXG4gIHN0YXRpYyBhbGwob3B0aW9ucykge1xuICAgIHJldHVybiB0aGlzLmRiLnNpbXBsZS5saXN0QXN5bmModGhpcy5jb2xsZWN0aW9uLCBvcHRpb25zKTtcbiAgfVxuXG4gIHN0YXRpYyBmaW5kQnlLZXkoaWQpIHtcbiAgICByZXR1cm4gdGhpcy5kYi5zaW1wbGUuZmlyc3RCeUV4YW1wbGVBc3luYyh0aGlzLmNvbGxlY3Rpb24sIHsgX2tleTogaWR9KTtcbiAgfVxuXG4gIHN0YXRpYyBmaW5kKHByZWRpY2F0ZSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgcmV0dXJuIHRoaXMuZGIuc2ltcGxlLmV4YW1wbGVBc3luYyh0aGlzLmNvbGxlY3Rpb24sIHByZWRpY2F0ZSwgb3B0aW9ucyk7XG4gIH1cblxuICBzdGF0aWMgcXVlcnkocXVlcnksIHBhcmFtcyA9IHt9LCBvcHRpb25zID0ge30pIHtcbiAgICByZXR1cm4gdGhpcy5kYi5xdWVyeS5leGVjQXN5bmMocXVlcnksIHBhcmFtcywgb3B0aW9ucyk7XG4gIH1cblxuICBzdGF0aWMgZXhpc3RzKHByZWRpY2F0ZSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgcmV0dXJuIHRoaXMuZGIuc2ltcGxlLmZpcnN0QnlFeGFtcGxlQXN5bmModGhpcy5jb2xsZWN0aW9uLCBwcmVkaWNhdGUsIG9wdGlvbnMpO1xuICB9XG5cbiAgc3RhdGljIHNhdmUoZW50aXR5LCBvcHRpb25zID0geyBjcmVhdGVDb2xsZWN0aW9uOiB0cnVlLCB3YWl0Rm9yU3luYzogdHJ1ZSB9KSB7XG4gICAgaWYgKGVudGl0eS5faWQpIHtcbiAgICAgIGlmIChlbnRpdHkuX2lkKSBkZWxldGUgZW50aXR5Ll9pZDtcbiAgICAgIGlmIChlbnRpdHkuX2tleSkgZGVsZXRlIGVudGl0eS5fa2V5O1xuICAgICAgaWYgKGVudGl0eS5fcmV2KSBkZWxldGUgZW50aXR5Ll9yZXY7XG5cbiAgICAgIHJldHVybiB0aGlzLmRiLmRvY3VtZW50LnB1dEFzeW5jKGVudGl0eS5faWQsIGVudGl0eSlcbiAgICAgICAgLnRoZW4odGhpcy5zaW5nbGUoZW50aXR5Ll9pZCkpO1xuICAgIH0gZWxzZVxuICAgICAgcmV0dXJuIHRoaXMuZGIuY3JlYXRlQXN5bmModGhpcy5jb2xsZWN0aW9uLCBlbnRpdHksIG9wdGlvbnMpXG4gICAgICAgIC50aGVuKHRoaXMuc2luZ2xlKGVudGl0eS5faWQpKTtcbiAgfVxuXG4gIHN0YXRpYyBkZWxldGUoaWQsIG9wdGlvbnMgPSB7fSkge1xuICAgIHJldHVybiB0aGlzLmRiLmRvY3VtZW50LmRlbGV0ZUFzeW5jKGlkLCBvcHRpb25zKTtcbiAgfVxuXG4gIHN0YXRpYyBkZWxldGVBbGwocHJlZGljYXRlLCBvcHRpb25zID0ge30pIHtcbiAgICByZXR1cm4gdGhpcy5kYi5zaW1wbGUucmVtb3ZlQnlFeGFtcGxlQXN5bmModGhpcy5jb2xsZWN0aW9uLCBwcmVkaWNhdGUsIG9wdGlvbnMpO1xuICB9XG5cbiAgc3RhdGljIGluaXRpYWxpemUoY29sbGVjdGlvbiwgc2NoZW1hLCBvcHRpb25zID0ge30pIHtcblxuICAgIGNsYXNzIFN0ZXJlb3R5cGUgZXh0ZW5kcyBNb2RlbCB7XG4gICAgICBjb25zdHJ1Y3RvcihpbnN0YW5jZSkge1xuICAgICAgICBzdXBlcihjb2xsZWN0aW9uLCBzY2hlbWEpO1xuXG4gICAgICAgIF8ubWVyZ2UodGhpcywgaW5zdGFuY2UpO1xuICAgICAgICBfLm1lcmdlKHRoaXMsIHRoaXMubWV0aG9kcyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy9UT0RPOiBTZXR1cCBTdGF0aWNzXG5cbiAgICBpZiAob3B0aW9ucy5zdGF0aWNzKSB7XG4gICAgICBfLm1lcmdlKFN0ZXJlb3R5cGUsIG9wdGlvbnMuc3RhdGljcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFN0ZXJlb3R5cGU7XG4gIH1cblxuXG59IiwiT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoZXhwb3J0cywgJF9fcGxhY2Vob2xkZXJfXzApOyIsIntnZXQ6ICRfX3BsYWNlaG9sZGVyX18wfSIsImdldCAkX19wbGFjZWhvbGRlcl9fMCgpIHsgcmV0dXJuICRfX3BsYWNlaG9sZGVyX18xOyB9IiwiX19lc01vZHVsZTogdHJ1ZSIsInt2YWx1ZTogJF9fcGxhY2Vob2xkZXJfXzB9IiwiKCRfX3BsYWNlaG9sZGVyX18wID0gcmVxdWlyZSgkX19wbGFjZWhvbGRlcl9fMSksIFxuICAgICAgICAkX19wbGFjZWhvbGRlcl9fMiAmJiAkX19wbGFjZWhvbGRlcl9fMy5fX2VzTW9kdWxlICYmICRfX3BsYWNlaG9sZGVyX180IHx8IHtkZWZhdWx0OiAkX19wbGFjZWhvbGRlcl9fNX0pIiwidmFyICRfX3BsYWNlaG9sZGVyX18wID0gJF9fcGxhY2Vob2xkZXJfXzEiLCJ2YXIgJF9fcGxhY2Vob2xkZXJfXzAgPSAkX19wbGFjZWhvbGRlcl9fMSIsIigkdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MpKCRfX3BsYWNlaG9sZGVyX18wLCAkX19wbGFjZWhvbGRlcl9fMSwgJF9fcGxhY2Vob2xkZXJfXzIpIiwiJHRyYWNldXJSdW50aW1lLnN1cGVyQ2FsbCgkX19wbGFjZWhvbGRlcl9fMCwgJF9fcGxhY2Vob2xkZXJfXzEsICRfX3BsYWNlaG9sZGVyX18yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkX19wbGFjZWhvbGRlcl9fMykiLCIoJHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKSgkX19wbGFjZWhvbGRlcl9fMCwgJF9fcGxhY2Vob2xkZXJfXzEsICRfX3BsYWNlaG9sZGVyX18yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJF9fcGxhY2Vob2xkZXJfXzMpIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9